<script type="module">
  // ===== Firebase imports =====
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    doc,
    getDocs,
    query,
    where,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
  import {
    getAuth,
    signInAnonymously
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAjbvQo7NrGZiFbFbdY3a7UtDjlv0SwU3w",
    authDomain: "smart-load-analyzer-56cb2.firebaseapp.com",
    projectId: "smart-load-analyzer-56cb2",
    storageBucket: "smart-load-analyzer-56cb2.firebasestorage.app",
    messagingSenderId: "253721588070",
    appId: "1:253721588070:web:c24bc2fbc27c2fba9e18a7",
    measurementId: "G-60RF97SGWN"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);
  const auth = getAuth(app);

  // ===== ÿ≠ÿßŸÑÿ© ÿßŸÑÿ£Ÿàÿ´ ŸÑŸÑÿ≥ÿßÿ¶ŸÇ (Anonymous) =====
  let authReady = false;
  let authPromise = null;

  async function ensureAuth() {
    if (authReady) return;
    if (!authPromise) {
      authPromise = signInAnonymously(auth)
        .then(() => { authReady = true; })
        .catch((err) => {
          console.error("Anonymous auth error:", err);
          authReady = false;
          throw err;
        });
    }
    return authPromise;
  }

  // ===== ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≥ÿßÿ¶ŸÇ =====
  let currentLang = "en";
  let currentDriver = null;
  let currentCompanyId = null;
  let companyListenerUnsub = null;

  // ================= DATA =================
  const translations = {
    en: {
      hdr_sub: "SMART LOAD ‚Äì DRIVER PORTAL",
      hdr_tag: "Driver & Admin Access",

      land_title: "Who is using this portal?",
      land_sub: "Choose your role to continue.",
      land_admin_title: "I am an Admin",
      land_driver_title: "I am a Driver",
      land_admin_btn: "Go to Admin Platform",
      land_driver_btn: "Continue as Driver",

      login_title: "Driver Login",
      login_sub: "Enter your Driver ID and Company Code.",
      login_back: "‚¨Ö Back",
      login_driverId_label: "Driver ID",
      login_company_label: "Company Code",
      login_btn: "Login as Driver",
      login_error_missing: "Please enter both Driver ID and Company Code.",
      login_generic: "Logged in. Waiting for dispatch assignment...",
      login_company_not_found: "Company not found. Please check the company code.",
      login_error: "Login error. Please try again.",

      dash_logout: "Logout",
      dash_assign_title: "Current Assignment",
      dash_status_ready: "‚úÖ Status: Ready for assignment",
      dash_status_arrived: "üü° Status: Arrived at location, waiting for loading",
      dash_status_loaded: "‚úÖ Status: Loaded ‚Äì ready to depart",
      dash_route_title: "Today's Route & Instructions",
      dash_route_sub: "Simple guidance from operations ‚Äî where to go and what to do.",
      dash_btn_arrived: "Mark as Arrived at Location",
      dash_btn_loaded: "Confirm Loading Complete",
      dash_note: "This driver view is a simple prototype. Operations can update instructions per driver.",
      dash_msg_arrived: "Arrival confirmed. Dispatch will see this status.",
      dash_msg_loaded: "Loading confirmed. You are ready to depart.",
      dash_welcome_prefix: "Welcome, ",
      dash_driver_info: "Driver ID: ",
      dash_company_info: " ¬∑ Company: ",
      dash_truck_info: " ¬∑ Truck: ",
      dash_no_assign: "No active assignment yet. Please wait for dispatch instructions.",
      dash_assign_route_only: "Route: {route}",

      tl1_label: "1. Go to:",
      tl1_desc: "Drive to the assigned destination.",
      tl2_label: "2. Confirm arrival",
      tl2_desc: "Use \"Mark as Arrived\" when you reach the location.",
      tl3_label: "3. Confirm loading",
      tl3_desc: "Use \"Confirm Loading Complete\" after finishing loading.",

      sup_title: "Customer Support",
      sup_phone_label: "Phone:",
      sup_email_label: "Email:",
      sup_fax_label: "Fax:",
      foot_portal: "Driver Portal"
    },

    ar: {
      hdr_sub: "SMART LOAD ‚Äì ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑÿ≥ÿßÿ¶ŸÇ",
      hdr_tag: "ÿØÿÆŸàŸÑ ÿßŸÑÿ•ÿØÿßÿ±Ÿä ŸàÿßŸÑÿ≥ÿßÿ¶ŸÇ",

      land_title: "ŸÖŸÜ Ÿäÿ≥ÿ™ÿÆÿØŸÖ Ÿáÿ∞Ÿá ÿßŸÑÿ®Ÿàÿßÿ®ÿ©ÿü",
      land_sub: "ÿßÿÆÿ™ÿ± ÿßŸÑÿØŸàÿ± ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©.",
      land_admin_title: "ÿ£ŸÜÿß ÿ•ÿØÿßÿ±Ÿä",
      land_driver_title: "ÿ£ŸÜÿß ÿ≥ÿßÿ¶ŸÇ",
      land_admin_btn: "ÿØÿÆŸàŸÑ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©",
      land_driver_btn: "ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ŸÉÿ≥ÿßÿ¶ŸÇ",

      login_title: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑÿ≥ÿßÿ¶ŸÇ",
      login_sub: "ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≥ÿßÿ¶ŸÇ ŸàŸÉŸàÿØ ÿßŸÑÿ¥ÿ±ŸÉÿ©.",
      login_back: "‚¨Ö ÿ±ÿ¨Ÿàÿπ",
      login_driverId_label: "ÿ±ŸÇŸÖ ÿßŸÑÿ≥ÿßÿ¶ŸÇ",
      login_company_label: "ŸÉŸàÿØ ÿßŸÑÿ¥ÿ±ŸÉÿ©",
      login_btn: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÉÿ≥ÿßÿ¶ŸÇ",
      login_error_missing: "ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≥ÿßÿ¶ŸÇ ŸàŸÉŸàÿØ ÿßŸÑÿ¥ÿ±ŸÉÿ©.",
      login_generic: "ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑÿå ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ±ÿ≠ŸÑÿ© ŸÖŸÜ ÿßŸÑÿ•ÿØÿßÿ±ÿ©...",
      login_company_not_found: "ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑÿ¥ÿ±ŸÉÿ©ÿå ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÉŸàÿØ ÿßŸÑÿ¥ÿ±ŸÉÿ©.",
      login_error: "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑÿå ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",

      dash_logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨",
      dash_assign_title: "ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©",
      dash_status_ready: "‚úÖ ÿßŸÑÿ≠ÿßŸÑÿ©: ÿ¨ÿßŸáÿ≤ ŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ ÿ±ÿ≠ŸÑÿ©",
      dash_status_arrived: "üü° ÿßŸÑÿ≠ÿßŸÑÿ©: ŸàÿµŸÑÿ™ ÿ•ŸÑŸâ ÿßŸÑŸÖŸàŸÇÿπ Ÿàÿ£ŸÜÿ™ÿ∏ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ",
      dash_status_loaded: "‚úÖ ÿßŸÑÿ≠ÿßŸÑÿ©: ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ‚Äì ÿ¨ÿßŸáÿ≤ ŸÑŸÑŸÖÿ∫ÿßÿØÿ±ÿ©",
      dash_route_title: "ŸÖÿ≥ÿßÿ± ÿßŸÑŸäŸàŸÖ ŸàÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™",
      dash_route_sub: "ÿ•ÿ±ÿ¥ÿßÿØÿßÿ™ ÿ®ÿ≥Ÿäÿ∑ÿ© ŸÖŸÜ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ‚Äî ÿ•ŸÑŸâ ÿ£ŸäŸÜ ÿ™ÿ∞Ÿáÿ® ŸàŸÖÿßÿ∞ÿß ÿ™ŸÅÿπŸÑ.",
      dash_btn_arrived: "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖŸàŸÇÿπ",
      dash_btn_loaded: "ÿ™ÿ£ŸÉŸäÿØ ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ",
      dash_note: "Ÿáÿ∞Ÿá Ÿàÿßÿ¨Ÿáÿ© ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©ÿå ŸàŸäŸÖŸÉŸÜ ŸÑŸÑÿ•ÿØÿßÿ±ÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÑŸÉŸÑ ÿ≥ÿßÿ¶ŸÇ.",
      dash_msg_arrived: "ÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸàÿµŸàŸÑÿå ÿ≥Ÿäÿ™ŸÖ ÿπÿ±ÿ∂ ÿßŸÑÿ≠ÿßŸÑÿ© ŸÑŸÇÿ≥ŸÖ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™.",
      dash_msg_loaded: "ÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑÿå ŸäŸÖŸÉŸÜŸÉ ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ© ÿßŸÑÿ¢ŸÜ.",
      dash_welcome_prefix: "ŸÖÿ±ÿ≠ÿ®Ÿãÿßÿå ",
      dash_driver_info: "ÿ±ŸÇŸÖ ÿßŸÑÿ≥ÿßÿ¶ŸÇ: ",
      dash_company_info: " ¬∑ ÿßŸÑÿ¥ÿ±ŸÉÿ©: ",
      dash_truck_info: " ¬∑ ÿßŸÑÿ¥ÿßÿ≠ŸÜÿ©: ",
      dash_no_assign: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≠ŸÑÿ© ŸÖŸÅÿπŸëŸÑÿ© ÿ≠ÿßŸÑŸäŸãÿßÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ™Ÿàÿ¨ŸäŸáÿßÿ™ ŸÇÿ≥ŸÖ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™.",
      dash_assign_route_only: "ÿßŸÑŸÖÿ≥ÿßÿ±: {route}",

      tl1_label: "1. ÿßŸÑÿ™Ÿàÿ¨ŸëŸá ÿ•ŸÑŸâ:",
      tl1_desc: "ÿ™Ÿàÿ¨ŸëŸá ÿ•ŸÑŸâ ÿßŸÑŸàÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©.",
      tl2_label: "2. ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸàÿµŸàŸÑ",
      tl2_desc: "ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ≤ÿ± \"ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸàÿµŸàŸÑ\" ÿπŸÜÿØ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖŸàŸÇÿπ.",
      tl3_label: "3. ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ",
      tl3_desc: "ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ≤ÿ± \"ÿ™ÿ£ŸÉŸäÿØ ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ\" ÿ®ÿπÿØ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°.",

      sup_title: "ÿÆÿØŸÖÿ© ÿßŸÑÿπŸÖŸÑÿßÿ°",
      sup_phone_label: "ÿßŸÑŸáÿßÿ™ŸÅ:",
      sup_email_label: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä:",
      sup_fax_label: "ÿßŸÑŸÅÿßŸÉÿ≥:",
      foot_portal: "ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑÿ≥ÿßÿ¶ŸÇ"
    }
  };

  // ============ LANGUAGE ============
  function setLanguage(lang) {
    currentLang = lang;
    const t = translations[lang];

    document.documentElement.lang = lang;
    document.documentElement.dir = (lang === "ar") ? "rtl" : "ltr";

    document.getElementById("btnLangEn").classList.toggle("active", lang === "en");
    document.getElementById("btnLangAr").classList.toggle("active", lang === "ar");

    document.getElementById("hdr_sub").textContent = t.hdr_sub;
    document.getElementById("hdr_tag").textContent = t.hdr_tag;

    document.getElementById("land_title").textContent = t.land_title;
    document.getElementById("land_sub").textContent = t.land_sub;
    document.getElementById("land_admin_title").textContent = t.land_admin_title;
    document.getElementById("land_driver_title").textContent = t.land_driver_title;
    document.getElementById("land_admin_btn").textContent = t.land_admin_btn;
    document.getElementById("land_driver_btn").textContent = t.land_driver_btn;

    document.getElementById("login_title").textContent = t.login_title;
    document.getElementById("login_sub").textContent = t.login_sub;
    document.getElementById("login_back").textContent = t.login_back;
    document.getElementById("login_driverId_label").textContent = t.login_driverId_label;
    document.getElementById("login_company_label").textContent = t.login_company_label;
    document.getElementById("login_btn").textContent = t.login_btn;

    document.getElementById("dash_logout").textContent = t.dash_logout;
    document.getElementById("dash_assign_title").textContent = t.dash_assign_title;
    document.getElementById("dash_route_title").textContent = t.dash_route_title;
    document.getElementById("dash_route_sub").textContent = t.dash_route_sub;
    document.getElementById("dash_btn_arrived").textContent = t.dash_btn_arrived;
    document.getElementById("dash_btn_loaded").textContent = t.dash_btn_loaded;
    document.getElementById("dash_note").textContent = t.dash_note;

    document.getElementById("sup_title").textContent = t.sup_title;
    document.getElementById("sup_phone_label").textContent = t.sup_phone_label;
    document.getElementById("sup_email_label").textContent = t.sup_email_label;
    document.getElementById("sup_fax_label").textContent = t.sup_fax_label;
    document.getElementById("foot_portal").textContent = t.foot_portal;

    const footer = document.getElementById("footerBox");
    footer.className = (lang === "ar") ? "footer-right" : "footer-left";

    document.getElementById("driverId").placeholder =
      (lang === "en") ? "e.g. 1023" : "ŸÖÿ´ÿßŸÑ: 1023";
    document.getElementById("companyCode").placeholder =
      (lang === "en") ? "e.g. LXPRT" : "ŸÖÿ´ÿßŸÑ: LXPRT";

    if (currentDriver) {
      fillDriverDashboard();
    }
  }

  // ============ VIEWS ============
  function switchView(id) {
    const views = document.querySelectorAll(".view");
    views.forEach(v => v.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  function goToAdmin() {
    window.location.href = "admin.html";
  }

  // ============ DASHBOARD ============

  function fillDriverDashboard() {
    const t = translations[currentLang];
    if (!currentDriver) return;

    const name = (currentLang === "ar")
      ? currentDriver.nameAr
      : currentDriver.nameEn;

    document.getElementById("driverWelcome").textContent =
      t.dash_welcome_prefix + name;

    let info = t.dash_driver_info + currentDriver.driverId +
               t.dash_company_info + currentDriver.companyCode;
    if (currentDriver.truck && currentDriver.truck !== "‚Äî") {
      info += t.dash_truck_info + currentDriver.truck;
    }
    document.getElementById("driverInfo").textContent = info;

    const statusEl = document.getElementById("driverStatusPill");
    statusEl.textContent = t.dash_status_ready;
    statusEl.className = "status-pill status-ok";

    const assignEl = document.getElementById("currentAssignment");
    if (!currentDriver.routeLabel) {
      assignEl.textContent = t.dash_no_assign;
      updateTimeline("");
    } else {
      const routeText = (t.dash_assign_route_only)
        .replace("{route}", currentDriver.routeLabel);
      assignEl.textContent = routeText;
      updateTimeline(currentDriver.routeLabel);
    }

    document.getElementById("driverActionMsg").textContent = "";
  }

  function updateTimeline(routeLabel) {
    const t = translations[currentLang];
    const tl = document.getElementById("driverTimeline");
    const cityDisplay = routeLabel || "";

    tl.innerHTML =
      '<div class="timeline-item">' +
        '<div class="timeline-label">' + t.tl1_label + ' ' + cityDisplay + '</div>' +
        '<div>' + t.tl1_desc + '</div>' +
      '</div>' +
      '<div class="timeline-item">' +
        '<div class="timeline-label">' + t.tl2_label + '</div>' +
        '<div>' + t.tl2_desc + '</div>' +
      '</div>' +
      '<div class="timeline-item">' +
        '<div class="timeline-label">' + t.tl3_label + '</div>' +
        '<div>' + t.tl3_desc + '</div>' +
      '</div>';
  }

  function applyDispatchToDriver(data) {
    if (!currentDriver) return;

    const origin = data.origin || "?";
    const destination = data.destination || "?";
    const routeLabel = `${origin} ‚Üí ${destination}`;
    const assignedTruckId = data.assignedTruckId || "‚Äî";

    currentDriver.routeLabel = routeLabel;
    currentDriver.truck = assignedTruckId;

    fillDriverDashboard();
  }

  // ============ LOGIN ============

  async function driverLogin() {
    const id = document.getElementById("driverId").value.trim();
    const companyCodeInput = document.getElementById("companyCode").value.trim().toUpperCase();
    const msg = document.getElementById("driverLoginMsg");
    const t = translations[currentLang];

    if (!id || !companyCodeInput) {
      msg.textContent = t.login_error_missing;
      msg.classList.add("hint-error");
      return;
    }
    msg.classList.remove("hint-error");

    // ŸÜŸÅÿµŸÑ ÿ£Ÿä listener ŸÇÿØŸäŸÖ
    if (companyListenerUnsub) {
      companyListenerUnsub();
      companyListenerUnsub = null;
    }
    currentCompanyId = null;

    try {
      // ‚úÖ ÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ Auth Anonymous ŸÇÿ®ŸÑ ŸÇÿ±ÿßÿ°ÿ© Firestore
      await ensureAuth();

      // ŸÜÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ¥ÿ±ŸÉÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ companyCode
      const companiesRef = collection(db, "companies");
      const q = query(companiesRef, where("companyCode", "==", companyCodeInput));
      const snap = await getDocs(q);

      if (snap.empty) {
        msg.textContent = t.login_company_not_found;
        msg.classList.add("hint-error");
        return;
      }

      const docSnap = snap.docs[0];
      currentCompanyId = docSnap.id;

      currentDriver = {
        driverId: id,
        companyCode: companyCodeInput,
        nameEn: "Driver " + id,
        nameAr: "ÿßŸÑÿ≥ÿßÿ¶ŸÇ " + id,
        truck: "‚Äî",
        routeLabel: null
      };

      msg.textContent = t.login_generic;
      fillDriverDashboard();
      switchView("view-driver-dashboard");

      // ŸÜÿ≥ŸÖÿπ ŸÑÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ¥ÿ±ŸÉÿ© ŸÑŸÑÿ≥ÿßÿ¶ŸÇ: /companies/{companyId}/driver/current
      const dispatchRef = doc(db, "companies", currentCompanyId, "driver", "current");
      companyListenerUnsub = onSnapshot(dispatchRef, (dispatchSnap) => {
        if (!dispatchSnap.exists()) {
          currentDriver.routeLabel = null;
          fillDriverDashboard();
          return;
        }
        const data = dispatchSnap.data();
        applyDispatchToDriver(data);
      });

    } catch (err) {
      console.error(err);
      msg.textContent = t.login_error;
      msg.classList.add("hint-error");
    }
  }

  // ============ BUTTON ACTIONS ============

  function markArrived() {
    const t = translations[currentLang];
    const statusEl = document.getElementById("driverStatusPill");
    statusEl.textContent = t.dash_status_arrived;
    statusEl.className = "status-pill status-warn";
    document.getElementById("driverActionMsg").textContent = t.dash_msg_arrived;
  }

  function markLoaded() {
    const t = translations[currentLang];
    const statusEl = document.getElementById("driverStatusPill");
    statusEl.textContent = t.dash_status_loaded;
    statusEl.className = "status-pill status-ok";
    document.getElementById("driverActionMsg").textContent = t.dash_msg_loaded;
  }

  // ============ LOGOUT ============

  function driverLogout() {
    if (companyListenerUnsub) {
      companyListenerUnsub();
      companyListenerUnsub = null;
    }
    currentCompanyId = null;
    currentDriver = null;

    document.getElementById("driverId").value = "";
    document.getElementById("companyCode").value = "";
    document.getElementById("driverLoginMsg").textContent = "";

    const t = translations[currentLang];
    document.getElementById("currentAssignment").textContent = t.dash_no_assign;
    updateTimeline("");

    switchView("view-driver-login");
  }

  // ÿ±ÿ®ÿ∑ ÿßŸÑÿØŸàÿßŸÑ ŸÅŸä window
  window.setLanguage   = setLanguage;
  window.switchView    = switchView;
  window.goToAdmin     = goToAdmin;
  window.driverLogin   = driverLogin;
  window.markArrived   = markArrived;
  window.markLoaded    = markLoaded;
  window.driverLogout  = driverLogout;

  window.addEventListener("DOMContentLoaded", function () {
    setLanguage("en");
  });
</script>
